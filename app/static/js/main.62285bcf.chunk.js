(this["webpackJsonprtc-web-client"]=this["webpackJsonprtc-web-client"]||[]).push([[0],{39:function(e,t,o){e.exports=o(76)},73:function(e,t){},76:function(e,t,o){"use strict";o.r(t);var n=o(0),r=o.n(n),a=o(38),i=o.n(a),c=o(1),s=o(5),l=o.n(s),d=o(6),u=o(2);var m=function(e){var t=Object(n.useState)(null),o=Object(c.a)(t,2),a=o[0],i=o[1];return Object(n.useEffect)((function(){console.log("Video Called ",e),a&&e.videoStream&&(a.srcObject=e.videoStream)}),[e.videoStream]),r.a.createElement("div",{style:Object(u.a)({},e.frameStyle)},r.a.createElement("video",Object(d.a)({style:Object(u.a)({},e.videoStyle),ref:e.videoStream,id:e.id,muted:e.muted,autoPlay:!0},"ref",(function(e){return i(e)}))))};var f=function(e){var t=Object(n.useState)([]),o=Object(c.a)(t,2),a=o[0],i=o[1],s=Object(n.useState)([]),l=Object(c.a)(s,2);l[0],l[1],Object(n.useEffect)((function(){console.log("Videos props ",e);var t=[];e.remoteStreams.forEach((function(e,o){t.push(d(e,o))})),console.log("Called Videos ",t),i(t)}),[e.remoteStreams]);var d=function(t,o){return console.log("Make Video View",o,t),r.a.createElement("div",{id:t.name,onClick:function(){e.switchVideo(t)},style:{display:"inline-block"},key:o},r.a.createElement(m,{videoStyle:{cursor:"pointer",objectFit:"cover",borderRadius:3,width:120},frameStyle:{float:"left",padding:"0 3px"},videoStream:t.stream,from:"Videos"}))};return r.a.createElement("div",{style:{zIndex:3,position:"fixed",padding:"6px 3px",backgroundColor:"rgb(0,0,0,0.3)",maxHeight:120,top:"auto",right:10,left:10,bottom:10,overflowX:"scroll",whiteSpace:"nowrap"}},a)};var p=o(11),v=o(7),S=o(8),h=o(10),g=o(9),b=(n.Component,function(e){Object(h.a)(o,e);var t=Object(g.a)(o);function o(e){var n;return Object(v.a)(this,o),(n=t.call(this,e)).makeVideoView=function(e,t){return console.log("Make Video View",t,e),r.a.createElement("div",{id:e.name,onClick:function(){n.props.switchVideo(e)},style:{display:"inline-block"},key:t},r.a.createElement(m,{videoStyle:{cursor:"pointer",objectFit:"cover",borderRadius:3,width:120},frameStyle:{float:"left",padding:"0 3px"},videoStream:e.stream,from:"Videos"}))},n.state={rVideos:[],remoteStreams:[]},n}return Object(S.a)(o,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(console.log("RemoteStreams Next props ",e.remoteStreams),console.log("RemoteStreams State ",this.state.remoteStreams),this.state.remoteStreams!==e.remoteStreams){console.log("Videos props ",this.props);var o=[];e.remoteStreams.forEach((function(e,n){o.push(t.makeVideoView(e,n))})),console.log("Called Videos ",o),this.setState({rVideos:o})}}},{key:"render",value:function(){return r.a.createElement("div",{style:{zIndex:3,position:"fixed",padding:"6px 3px",backgroundColor:"rgb(0,0,0,0.3)",maxHeight:120,top:"auto",right:10,left:10,bottom:10,overflowX:"scroll",whiteSpace:"nowrap"}},this.state.rVideos)}}]),o}(n.Component)),k=function(e){Object(h.a)(o,e);var t=Object(g.a)(o);function o(e){var n;return Object(v.a)(this,o),(n=t.call(this,e)).getLocalStream=function(){navigator.mediaDevices.getUserMedia(n.state.mediaConstraints).then((function(e){n.setState({localStream:e},(function(){return n.whoIsOnline()}))})).catch((function(e){console.log("Error while getting camera ",e)}))},n.socketEventHandler=function(){n.socket.on("connection-success",(function(e){n.getLocalStream();var t=e.peerCount>1?"Total Connected Peers ".concat(e.peerCount):"Waiting for other peers to connect";n.setState({status:t})})),n.socket.on("joined-peers",(function(e){var t=e.peerCount>1?"Total Connected Peers ".concat(e.peerCount):"Waiting for other peers to connect";n.setState({status:t})})),n.socket.on("peer-disconnected",(function(e){var t=n.state,o=t.selectedVideo,r=t.remoteStreams,a=Object(p.a)(r).filter((function(t){return t.id!==e.socketId})),i=e.peerCount>1?"Total Connected Peers ".concat(e.peerCount):"Waiting for other peers to connect";o&&o.id===e.socketId&&r.length&&n.setState({status:i,selectedVideo:r[0],remoteStreams:a})})),n.socket.on("candidate",(function(e){var t=n.state.peerConnections[e.socketId];t&&t.addIceCandidate(new RTCIceCandidate(e.candidate))})),n.socket.on("online-peer",(function(e){var t=n.state.sdpConstraints;n.createPeerConnection(e,(function(o){o&&o.createOffer(t).then((function(t){o.setLocalDescription(t),n.sendToServer("offer",t,{local:n.socket.id,remote:e})}),(function(e){console.log("Error create offer",e)}))}))})),n.socket.on("offer",(function(e){var t=n.state,o=t.sdpConstraints,r=t.localStream;n.createPeerConnection(e.socketId,(function(t){t&&(t.addStream(r),t.setRemoteDescription(new RTCSessionDescription(e.sdp)).then((function(){t.createAnswer(o).then((function(o){t.setLocalDescription(o),n.sendToServer("answer",o,{local:n.socket.id,remote:e.socketId})}),(function(e){console.log("Error create answer",e)}))})))}))})),n.socket.on("answer",(function(e){var t=n.state,o=t.peerConnections;t.remoteStreams;o[e.socketId].setRemoteDescription(new RTCSessionDescription(e.sdp)).then((function(){}))}))},n.createPeerConnection=function(e,t){var o=n.state,r=o.peerConnections,a=o.pcConfig,i=o.remoteStreams,c=o.selectedVideo,s=o.localStream;try{var l=new RTCPeerConnection(a),d=Object(u.a)({},r);d[e]=l,n.setState({peerConnections:d}),l.onicecandidate=function(t){t.candidate&&n.sendToServer("candidate",t.candidate,{local:n.socket.id,remote:e})},l.oniceconnectionstatechange=function(e){},l.ontrack=function(t){var o={id:e,name:e,stream:t.streams[0]};i.length<=0&&n.setState({remoteStream:t.streams[0]}),Object(p.a)(i).filter((function(e){return c&&e.id===c.id})).length||n.setState({selectedVideo:o});var r=Object(p.a)(i);r.push(o),n.setState({remoteStreams:r})},l.close=function(){},s&&l.addStream(s),t(l)}catch(m){console.log("Error while creating peer connections",m),t(null)}},n.whoIsOnline=function(){n.sendToServer("onlinePeers",null,{local:n.socket.id})},n.sendToServer=function(e,t,o){n.socket.emit(e,{socketId:o,payload:t})},n.statusTextView=function(){var e=n.state.status;return r.a.createElement("div",{style:{padding:8,color:"yellow"}},e)},n.state={localStream:null,remoteStream:null,remoteStreams:[],peerConnections:{},selectedVideo:null,status:"Please wait...",serverUrl:"http://localhost:8080/",pcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},sdpConstraints:{mandatory:{offerToReceiveVideo:!0,offerToReceiveAudio:!0}},mediaConstraints:{audio:!0,video:!0,options:{mirror:!0}}},n.socket=null,n}return Object(S.a)(o,[{key:"componentDidMount",value:function(){this.socket=l()("".concat(this.state.serverUrl,"webrtcPeer")),this.socketEventHandler()}},{key:"render",value:function(){var e=this,t=this.state,o=t.selectedVideo,n=t.remoteStreams,a=t.localStream;return r.a.createElement("div",null,r.a.createElement(m,{videoStyle:{position:"fixed",right:0,height:300,width:300,margin:8,zIndex:2,background:"#0f0f0f"},videoStream:a,autoPlay:!0,muted:!0,from:"AppC local"}),r.a.createElement(m,{videoStyle:{height:"100%",width:"100%",background:"#0f0f0f",zIndex:1,position:"fixed",bottom:0},videoStream:o&&o.stream,autoPlay:!0,muted:!0,from:"AppC remote"}),r.a.createElement("br",null),r.a.createElement("div",{style:{zIndex:3,position:"absolute",margin:6,padding:6,borderRadius:6,backgroundColor:"#cdc4ff4f"}},this.statusTextView()),r.a.createElement("div",null,console.log("AppC remoteStreams ",n),r.a.createElement(b,{switchVideo:function(t){return e.setState({selectedVideo:t})},remoteStreams:this.state.remoteStreams})))}}]),o}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[39,1,2]]]);
//# sourceMappingURL=main.62285bcf.chunk.js.map